import{d as k,r as n,B,G as E,H as w,u as P,a as v,m as $,w as F,e as z,t as S,c as A}from"./index.855284fc.js";import{_ as R}from"./BaseForm.vue_vue_type_script_setup_true_lang.cfd44047.js";const x=(m,s,t)=>{const d=s*Math.min(t,1-t),l=(c,o=(c+m/30)%12)=>t-d*Math.max(Math.min(o-3,9-o,1),-1);return[l(0),l(8),l(4)]},e=m=>{const s=getComputedStyle(document.documentElement).getPropertyValue(`--${m}`).trim().replace("deg","");if(s.startsWith("hsl")){const t=s.replace("hsl(","").replace(")","").split(",");return`rgb(${x(parseInt(t[0]),parseInt(t[1])/100,parseInt(t[2])/100).map(c=>Math.round(c*255)).join(",")})`}return s},O={key:1},D=k({__name:"AddPaymentMethod",emits:["success"],setup(m,{emit:s}){const t=n(!1),d=n(!1),l=n(!1),c=n(),o=B(),r=E({paymentMethod:"",error:"",processing:!1}),h=n(!1),_=n(),y=n(),p=n();w(()=>{C()});const C=async()=>{const a=await o.getPaymentIntent();a&&(p.value=a.client_secret)},I=async()=>{var i,u,b;r.processing=!0;const a=y.value.stripeElement;_.value.instance.confirmCardSetup(p.value,{payment_method:{card:a,billing_details:{name:((i=o.user)==null?void 0:i.name)+" "+((u=o.user)==null?void 0:u.surname),email:(b=o.user)==null?void 0:b.email}}}).then(f=>{if(f.error)r.error=f.error.message,alert(r.error),r.processing=!1;else{if(!o.isAuthenticated)return;o.addPaymentMethod(f.setupIntent.payment_method).then(g=>{if(!g)throw new Error("Error adding payment method");s("success"),r.processing=!1}).catch(g=>{r.error=g.response.data.message,r.processing=!1})}})};e("primary"),e("form-element-background-color"),e("form-element-color"),e("form-element-invalid-border-color"),e("font-size"),e("border-radius"),e("form-element-color"),e("form-element-color"),e("font-weight"),e("font-size"),e("line-height"),e("form-element-placeholder-color"),e("form-element-invalid-border-color"),e("form-element-invalid-border-color");const M=()=>{y.value.stripeElement.focus()};return(a,i)=>P(o).isAuthenticated?(v(),$(R,{key:0,ref_key:"baseForm",ref:c,onSubmit:I,disabled:t.value||!h.value||!d.value||!l.value||!p.value,"is-loading":r.processing||!h.value,"data-cy":"add-payment-form"},{default:F(()=>[z("label",{onClick:i[0]||(i[0]=u=>M())},S(a.$t("Add a payment method")),1)]),_:1},8,["disabled","is-loading"])):(v(),A("div",O,S(a.$t("Login or sign up to continue")),1))}});export{D as _};
